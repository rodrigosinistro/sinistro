const _0x17e9fc=_0x53bf;(function(_0x2185b9,_0x44b3ba){const _0x2f11b0=_0x53bf,_0x115eec=_0x2185b9();while(!![]){try{const _0x35b4d4=parseInt(_0x2f11b0(0x160))/0x1+parseInt(_0x2f11b0(0x12c))/0x2+parseInt(_0x2f11b0(0x14a))/0x3*(-parseInt(_0x2f11b0(0x15b))/0x4)+parseInt(_0x2f11b0(0x133))/0x5*(parseInt(_0x2f11b0(0x132))/0x6)+parseInt(_0x2f11b0(0x157))/0x7*(-parseInt(_0x2f11b0(0x14b))/0x8)+-parseInt(_0x2f11b0(0x15c))/0x9*(parseInt(_0x2f11b0(0x139))/0xa)+-parseInt(_0x2f11b0(0x140))/0xb*(-parseInt(_0x2f11b0(0x151))/0xc);if(_0x35b4d4===_0x44b3ba)break;else _0x115eec['push'](_0x115eec['shift']());}catch(_0x128d72){_0x115eec['push'](_0x115eec['shift']());}}}(_0xa6ff,0x4bebc));import{SharedConsts}from'../shared/SharedConsts.js';import{Config}from'./Config.js';import{Menu}from'./Menu.js';function _0x53bf(_0x3c722a,_0xbc17d8){const _0xa6ffd4=_0xa6ff();return _0x53bf=function(_0x53bf71,_0x4b16eb){_0x53bf71=_0x53bf71-0x129;let _0x4fa602=_0xa6ffd4[_0x53bf71];return _0x4fa602;},_0x53bf(_0x3c722a,_0xbc17d8);}import{UtilApplications}from'./UtilApplications.js';import{PopoutSheet}from'./PopoutSheet.js';import{UtilLibWrapper}from'./PatcherLibWrapper.js';function _0xa6ff(){const _0x5c721f=['display','_init_registerKeybindEsc','saveFog','MODULE_NAME','KEYBINDINGS.Dismiss','keys','11BDdcmg','menu','_LAST_KEYBOARD_EVENT_INFO','last','isFixEscapeKey','target','releaseAll','preventDefault','register','MODULE_NAME_FAKE','24waqQCn','40jwrLAR','close','_pHandleConfigUpdate','key','activeLayer','isPoppedOut','6567708eaWJdL','length','pLock','set','unlock','keybindings','546427gbGrlw','filter','PRIORITY','addPatch','136280ivcbMr','519471VwSsDo','_MODAL_STACK','INPUT','windows','396465nOSgBK','sight','event','_lw_game_keyboard_hasFocus','_ACTION_DISMISS','context','_LOCK_EDIT_KEYBINDS','isEscapeable','children','closeAllMenus','preview','_pHandleConfigUpdate_','_init_patchEscapeMethods','_controlled','189888qxgEJq','blur','getOpenAppsSortedByZindex','toggle','.configUpdate','ready','126igPnoi','25780VXzaRm','LIBWRAPPER_MODE_WRAPPER','element','hasFocus','nodeName','_lw_game_keyboard__handleKeyboardEvent','30oltRke'];_0xa6ff=function(){return _0x5c721f;};return _0xa6ff();}class Patcher_GameKeyboard{static['preInit'](){const _0xbd7487=_0x53bf;this[_0xbd7487(0x13b)]();}static['init'](){const _0x2255e7=_0x53bf;Hooks['on'](SharedConsts[_0x2255e7(0x149)]+_0x2255e7(0x130),()=>this[_0x2255e7(0x14d)]()),this[_0x2255e7(0x14d)](),this[_0x2255e7(0x12a)]();}static['_init_patchEscapeMethods'](){const _0x576377=_0x53bf;UtilLibWrapper[_0x576377(0x15a)]('game.keyboard._handleKeyboardEvent',this['_lw_game_keyboard__handleKeyboardEvent'],UtilLibWrapper[_0x576377(0x134)]),UtilLibWrapper[_0x576377(0x15a)]('game.keyboard.hasFocus',this[_0x576377(0x163)],UtilLibWrapper[_0x576377(0x134)]);}static[_0x17e9fc(0x138)](_0x2506a1,..._0x161a90){const _0x280429=_0x17e9fc,_0x39acb6=_0x2506a1(..._0x161a90);return Patcher_GameKeyboard[_0x280429(0x142)]={'event':_0x161a90[0x0],'isUp':_0x161a90[0x1]},_0x39acb6;}static[_0x17e9fc(0x163)](_0x119ab7,..._0x1e5643){const _0x50eb10=_0x17e9fc,_0x2fc093=_0x119ab7(..._0x1e5643);if(!Config['get']('ui',_0x50eb10(0x144)))return _0x2fc093;if(Patcher_GameKeyboard[_0x50eb10(0x142)]?.[_0x50eb10(0x162)]?.[_0x50eb10(0x14e)]!=='Escape')return _0x2fc093;return![];}static async[_0x17e9fc(0x14d)](){const _0x4a9d19=_0x17e9fc;try{await Patcher_GameKeyboard[_0x4a9d19(0x166)][_0x4a9d19(0x153)](),await this[_0x4a9d19(0x129)]();}finally{Patcher_GameKeyboard[_0x4a9d19(0x166)][_0x4a9d19(0x155)]();}}static async[_0x17e9fc(0x129)](){const _0x47acac=_0x17e9fc;game[_0x47acac(0x156)][_0x47acac(0x154)](SharedConsts[_0x47acac(0x13d)],Patcher_GameKeyboard[_0x47acac(0x164)]);if(!Config['get']('ui','isFixEscapeKey'))return;game[_0x47acac(0x156)][_0x47acac(0x154)](SharedConsts[_0x47acac(0x13d)],Patcher_GameKeyboard[_0x47acac(0x164)],[{'key':'Escape'}]);}static[_0x17e9fc(0x13b)](){const _0x32038f=_0x17e9fc;game['keybindings'][_0x32038f(0x148)](SharedConsts[_0x32038f(0x13d)],Patcher_GameKeyboard['_ACTION_DISMISS'],{'name':_0x32038f(0x13e),'hint':'An\x20improved\x20version\x20of\x20Foundry\x27s\x20built-in\x20binding.\x20Bind\x20the\x20\x22Escape\x22\x20key\x20to\x20(in\x20this\x20order):\x20de-select\x20active\x20input\x20fields;\x20de-select\x20selected\x20canvas\x20elements;\x20close\x20context\x20menus;\x20close\x20individual\x20windows\x20in\x20most-recently-active-first\x20order;\x20toggle\x20the\x20main\x20menu.','onDown':_0x505aec=>{const _0x7af8e7=_0x32038f,{event:_0x1d364b}=_0x505aec;if(UiUtil[_0x7af8e7(0x15d)]&&UiUtil[_0x7af8e7(0x15d)][_0x7af8e7(0x152)])return!![];if(ui[_0x7af8e7(0x141)][_0x7af8e7(0x135)]&&ui[_0x7af8e7(0x141)][_0x7af8e7(0x135)]?.[0x0]?.['style']?.[_0x7af8e7(0x13a)]==='')return ui[_0x7af8e7(0x141)][_0x7af8e7(0x12f)](),!![];if(document[_0x7af8e7(0x136)]()&&Patcher_GameKeyboard['_ELEMENTS_WITH_FOCUS']['has'](_0x1d364b['target'][_0x7af8e7(0x137)]))return _0x1d364b[_0x7af8e7(0x145)][_0x7af8e7(0x12d)](),!![];if(canvas[_0x7af8e7(0x131)])canvas[_0x7af8e7(0x161)][_0x7af8e7(0x13c)]();if(ui['context']&&ui[_0x7af8e7(0x165)]['menu']['length'])ui[_0x7af8e7(0x165)][_0x7af8e7(0x14c)]();else{if(Menu[_0x7af8e7(0x169)]())return!![];else{if(canvas[_0x7af8e7(0x131)]&&Object[_0x7af8e7(0x13f)](canvas['activeLayer']?.[_0x7af8e7(0x12b)]||{})[_0x7af8e7(0x152)]){_0x1d364b[_0x7af8e7(0x147)]();if(!canvas[_0x7af8e7(0x14f)][_0x7af8e7(0x16a)]?.[_0x7af8e7(0x168)]['length'])canvas['activeLayer'][_0x7af8e7(0x146)]();}else{if(Object['values'](ui[_0x7af8e7(0x15f)])['filter'](_0x257519=>(_0x257519[_0x7af8e7(0x167)]==null||_0x257519[_0x7af8e7(0x167)]===!![])&&!PopoutSheet[_0x7af8e7(0x150)](_0x257519))[_0x7af8e7(0x152)])UtilApplications[_0x7af8e7(0x12e)]()[_0x7af8e7(0x158)](_0x3cf967=>(_0x3cf967[_0x7af8e7(0x167)]==null||_0x3cf967[_0x7af8e7(0x167)]===!![])&&!PopoutSheet[_0x7af8e7(0x150)](_0x3cf967))[_0x7af8e7(0x143)]()[_0x7af8e7(0x14c)]();else ui[_0x7af8e7(0x141)][_0x7af8e7(0x12f)]();}}}return!![];},'restricted':![],'precedence':CONST['KEYBINDING_PRECEDENCE'][_0x32038f(0x159)]});}}Patcher_GameKeyboard[_0x17e9fc(0x164)]='KEYBINDINGS.Dismiss',Patcher_GameKeyboard['_ELEMENTS_WITH_FOCUS']=new Set([_0x17e9fc(0x15e),'TEXTAREA']),Patcher_GameKeyboard[_0x17e9fc(0x166)]=new VeLock(),Patcher_GameKeyboard[_0x17e9fc(0x142)]=null;export{Patcher_GameKeyboard};