const _0x2dbe37=_0x4e10;(function(_0x1225f5,_0x364bf0){const _0x22a28c=_0x4e10,_0x25257d=_0x1225f5();while(!![]){try{const _0x55bb70=-parseInt(_0x22a28c(0x193))/0x1*(-parseInt(_0x22a28c(0x1c6))/0x2)+-parseInt(_0x22a28c(0x190))/0x3+-parseInt(_0x22a28c(0x186))/0x4+-parseInt(_0x22a28c(0x1b0))/0x5*(-parseInt(_0x22a28c(0x19a))/0x6)+parseInt(_0x22a28c(0x18d))/0x7+parseInt(_0x22a28c(0x19b))/0x8*(parseInt(_0x22a28c(0x185))/0x9)+-parseInt(_0x22a28c(0x184))/0xa*(parseInt(_0x22a28c(0x177))/0xb);if(_0x55bb70===_0x364bf0)break;else _0x25257d['push'](_0x25257d['shift']());}catch(_0x38bd44){_0x25257d['push'](_0x25257d['shift']());}}}(_0x1105,0xe4ef4));import{UtilApplications}from'./UtilApplications.js';import{Config}from'./Config.js';function _0x1105(){const _0x1e6536=['join','copy','cell','</div>','utils','ROLL_COL_NONE','name','exec','flat','_pGetTableRollableTable_pOtherTable','_getTableDescription','10jpcRXf','27ZKuwrP','3030024GZOvfu','importTable','permissions','<div>','stripTags','roll','_getHighestRoll','3152394NEXijs','pGetWithDescriptionPlugins','<div>\x0a\x09\x09\x09\x09<p>The\x20following\x20tables\x20belong\x20to\x20this\x20group:</p>\x0a\x09\x09\x09\x09','3703701TcwJkq','getCleanEntityName','SYM_AT','37wcnoRx','getAutoConvertedTableRollMode','get','caption','pSerialAwaitMap','splitTagByPipe','getNameWithSourcePart','214482AqxHPC','4057816KPppIH','slice','getCleanDiceString','randomID','_getRollRange','min','table','pGetTableRollableTable','pGetTableResult','_getFoundryDiceTagged','range','Only\x20one\x20of\x20\x22rangeExact\x22\x20and\x20\x22rangeLow/rangeHigh\x22\x20may\x20be\x20specified!','getColRollType','pGetTableJournal','row','permission','_IMG_FALLBACK','isAddPermission','list','trim','_pGetSaveImagePath','185OUyuGl','max','_pGetResultText','toLowerCase','icons/svg/d20-black.svg','pOptionallySaveImageToServerAndGetUrl','Table\x20columns:\x20','\x20|\x20','walk','some','render','getWalker','_pGetTableRollableTable_pRollTable','modules/','results','map','_isRollableTable_getEntriesTableRollMode','now','defaultPermission','getConvertedTagLinkEntries','TABLE_RESULT_TYPES','type','27066uKlrBU','TEXT','GENERIC_WALKER_ENTRIES_KEY_BLACKLIST','exact','replace','length','rows','data','colLabels','9521534hbRsEN','setFirstSection'];_0x1105=function(){return _0x1e6536;};return _0x1105();}function _0x4e10(_0x2a3d1a,_0x44b181){const _0x110500=_0x1105();return _0x4e10=function(_0x4e1074,_0x148f66){_0x4e1074=_0x4e1074-0x173;let _0x3a36d9=_0x110500[_0x4e1074];return _0x3a36d9;},_0x4e10(_0x2a3d1a,_0x44b181);}import{DataConverter}from'./DataConverter.js';import{Vetools}from'./Vetools.js';import{UtilDataConverter}from'./UtilDataConverter.js';import{SharedConsts}from'../shared/SharedConsts.js';class DataConverterTable extends DataConverter{static [_0x2dbe37(0x1ab)]=_0x2dbe37(0x1bd)+SharedConsts['MODULE_NAME']+'/media/icon/hamburger-menu.svg';static['getTableGroupJournal'](_0xd2fc25,_0x65ed64,_0x11a1ca){const _0x1a6d8d=_0x2dbe37;_0x11a1ca=_0x11a1ca||{};const _0x183e90={'type':_0x1a6d8d(0x1ad),'items':_0x65ed64[_0x1a6d8d(0x1bf)](_0x14f89c=>DataConverter[_0x1a6d8d(0x192)]+'RollTable['+_0x14f89c['id']+']{'+(_0x14f89c[_0x1a6d8d(0x196)]||_0x14f89c[_0x1a6d8d(0x17f)])+'}')},_0x359fa5={'name':UtilApplications[_0x1a6d8d(0x191)](_0xd2fc25[_0x1a6d8d(0x17f)]),'permission':{'default':0x0},'entryTime':Date[_0x1a6d8d(0x1c1)](),'content':_0x1a6d8d(0x18f)+Renderer['get']()[_0x1a6d8d(0x178)](!![])[_0x1a6d8d(0x1ba)](_0x183e90)['replace'](new RegExp(DataConverter['SYM_AT'],'g'),'@')+'\x0a\x09\x09\x09\x09</div>'};if(_0x11a1ca['defaultPermission']!=null)_0x359fa5['permission']={'default':_0x11a1ca[_0x1a6d8d(0x1c2)]};else{if(_0x11a1ca[_0x1a6d8d(0x1ac)])_0x359fa5['permission']={'default':Config['get']('importTable','permissions')};}return _0x359fa5;}static[_0x2dbe37(0x1a2)](_0x56a111,_0xdc8053){const _0xc9aee0=_0x2dbe37;_0xdc8053=_0xdc8053||{};if(_0xdc8053['isImportAsJournalEntry'])return this[_0xc9aee0(0x1a8)](_0x56a111,_0xdc8053);if(this['_isRollableTable'](_0x56a111))return this[_0xc9aee0(0x1bc)](_0x56a111,_0xdc8053);else return this[_0xc9aee0(0x182)](_0x56a111,_0xdc8053);}static['_isRollableTable'](_0x13dd3a){const _0x5387aa=_0x2dbe37;return this[_0x5387aa(0x1c0)](_0x13dd3a)||Renderer[_0x5387aa(0x194)](_0x13dd3a);}static['_isRollableTable_getEntriesTableRollMode'](_0x35eba2){const _0x2c23e1=_0x2dbe37;if(!_0x35eba2['colLabels']||_0x35eba2[_0x2c23e1(0x176)][_0x2c23e1(0x173)]<0x2)return RollerUtil[_0x2c23e1(0x17e)];const _0x39be67=RollerUtil[_0x2c23e1(0x1a7)](_0x35eba2[_0x2c23e1(0x176)][0x0]);if(!_0x39be67)return RollerUtil[_0x2c23e1(0x17e)];if(_0x35eba2[_0x2c23e1(0x174)][_0x2c23e1(0x1b9)](_0x5d4ae0=>_0x5d4ae0[0x0]?.[_0x2c23e1(0x1c5)]!==_0x2c23e1(0x17b)||_0x5d4ae0[0x0][_0x2c23e1(0x18b)]==null||_0x5d4ae0[0x0][_0x2c23e1(0x18b)][_0x2c23e1(0x1c9)]==null&&_0x5d4ae0[0x0][_0x2c23e1(0x18b)][_0x2c23e1(0x1a0)]==null&&_0x5d4ae0[0x0][_0x2c23e1(0x18b)][_0x2c23e1(0x1b1)]==null))return RollerUtil[_0x2c23e1(0x17e)];return _0x39be67;}static[_0x2dbe37(0x183)](_0xdf981c){const _0xb31206=_0x2dbe37;return _0xdf981c[_0xb31206(0x176)]?.['length']?_0xb31206(0x1b6)+_0xdf981c[_0xb31206(0x176)][_0xb31206(0x1bf)](_0x185a72=>Renderer[_0xb31206(0x18a)](_0x185a72))[_0xb31206(0x179)](_0xb31206(0x1b7)):'';}static async[_0x2dbe37(0x1bc)](_0x3ea81e,_0xc9895f){const _0x184f58=_0x2dbe37;_0xc9895f=_0xc9895f||{};const _0x15eb54=await this['_pGetSaveImagePath'](_0x3ea81e,{'propCompendium':'table'}),_0x16368b=(_0x3ea81e[_0x184f58(0x176)][0x0]||'')[_0x184f58(0x1ae)]()['replace'](/{@dice ([^}]+)}/,'$1'),_0x2d7ea6={'name':UtilApplications[_0x184f58(0x191)](_0x3ea81e['name']),'formula':_0x16368b,'description':this[_0x184f58(0x183)](_0x3ea81e),'results':await _0x3ea81e[_0x184f58(0x174)][_0x184f58(0x197)](async(_0x582c3b,_0x45f67a)=>{const _0x5d3023=_0x184f58,{rangeLow:_0x43d5c5,rangeHigh:_0x35bfda}=this[_0x5d3023(0x19f)](_0x16368b,_0x582c3b[0x0]);return this[_0x5d3023(0x1a3)]({'type':CONST[_0x5d3023(0x1c4)][_0x5d3023(0x1c7)],'text':await this[_0x5d3023(0x1b2)](_0x582c3b[_0x5d3023(0x19c)](0x1)),'rangeLow':_0x43d5c5,'rangeHigh':_0x35bfda});}),'replacement':!![],'displayRoll':!![],'img':_0x15eb54};if(_0xc9895f['defaultPermission']!=null)_0x2d7ea6[_0x184f58(0x1aa)]={'default':_0xc9895f[_0x184f58(0x1c2)]};else{if(_0xc9895f[_0x184f58(0x1ac)])_0x2d7ea6[_0x184f58(0x1aa)]={'default':Config[_0x184f58(0x195)](_0x184f58(0x187),'permissions')};}return _0x2d7ea6;}static[_0x2dbe37(0x19f)](_0x211134,_0x163f2e){const _0x274b58=_0x2dbe37;if(_0x163f2e[_0x274b58(0x1c5)]===_0x274b58(0x17b)&&_0x163f2e[_0x274b58(0x18b)]!=null){if(_0x163f2e[_0x274b58(0x18b)][_0x274b58(0x1c9)]!=null)return{'rangeLow':_0x163f2e[_0x274b58(0x18b)]['exact'],'rangeHigh':_0x163f2e[_0x274b58(0x18b)]['exact']};const _0x4260fa=_0x163f2e['roll'][_0x274b58(0x1b1)]<_0x163f2e['roll'][_0x274b58(0x1a0)]?this[_0x274b58(0x18c)](_0x211134):_0x163f2e['roll']['max'];return{'rangeLow':_0x163f2e['roll'][_0x274b58(0x1a0)],'rangeHigh':_0x4260fa};}let _0x363575,_0x594a19;const _0x75486a=String(_0x163f2e)['trim'](),_0x407498=/^(\d+)([-\u2013](\d+))?$/[_0x274b58(0x180)](_0x75486a);if(_0x407498){if(_0x407498[0x1]&&!_0x407498[0x2]){_0x363575=Number(_0x407498[0x1]);if(_0x363575===0x0)_0x363575=this[_0x274b58(0x18c)](_0x211134);_0x594a19=_0x363575;}else _0x363575=Number(_0x407498[0x1]),_0x594a19=Number(_0x407498[0x3]),_0x594a19<_0x363575&&(_0x594a19=this[_0x274b58(0x18c)](_0x211134));return{'rangeLow':_0x363575,'rangeHigh':_0x594a19};}const _0x3057f1=/^(\d+) or less$/i[_0x274b58(0x180)](_0x75486a);if(_0x3057f1)return _0x363575=0x1,_0x594a19=Number(_0x3057f1[0x1]),{'rangeLow':_0x363575,'rangeHigh':_0x594a19};const _0x245dbb=/^(\d+)\+$/['exec'](_0x75486a);return _0x363575=Number(_0x245dbb[0x1]),_0x594a19=_0x363575,{'rangeLow':_0x363575,'rangeHigh':_0x594a19};}static async[_0x2dbe37(0x1b2)](_0x1d6aca){const _0x2a2208=_0x2dbe37,_0x154c7c=MiscUtil[_0x2a2208(0x1bb)]({'keyBlacklist':MiscUtil[_0x2a2208(0x1c8)]});let _0x9a8281=UtilDataConverter[_0x2a2208(0x1c3)](MiscUtil[_0x2a2208(0x17a)](_0x1d6aca));return _0x9a8281=_0x154c7c[_0x2a2208(0x1b8)](_0x9a8281,{'string':_0x387c50=>{const _0x2e48b9=_0x2a2208;return Renderer['stripTags'](this[_0x2e48b9(0x1a4)](_0x387c50));}}),_0x9a8281['map'](_0x156af5=>Renderer[_0x2a2208(0x195)]()['setFirstSection'](!![])[_0x2a2208(0x1ba)](_0x156af5))[_0x2a2208(0x179)]('\x20|\x20');}static[_0x2dbe37(0x18c)](_0x5a919f){const _0x530128=/\d+/['exec'](_0x5a919f);if(_0x530128)return Number(_0x530128[0x0]);return 0x64;}static async[_0x2dbe37(0x182)](_0xe8076b,_0x650a30){const _0x507ebc=_0x2dbe37;_0x650a30=_0x650a30||{};const _0x2423fe=await this[_0x507ebc(0x1af)](_0xe8076b,{'propCompendium':_0x507ebc(0x1a1)}),_0x3f1f36={'name':UtilApplications['getCleanEntityName'](_0xe8076b[_0x507ebc(0x17f)]),'formula':'1d'+(_0xe8076b[_0x507ebc(0x174)]?_0xe8076b[_0x507ebc(0x174)]['length']:'1'),'description':this[_0x507ebc(0x183)](_0xe8076b),'results':await _0xe8076b[_0x507ebc(0x174)]['pSerialAwaitMap'](async(_0x4862c9,_0x7198c6)=>{const _0x5c3b6d=_0x507ebc;return _0x4862c9=_0x4862c9[_0x5c3b6d(0x1a9)]||_0x4862c9,this[_0x5c3b6d(0x1a3)]({'type':CONST[_0x5c3b6d(0x1c4)]['TEXT'],'text':await this['_pGetResultText'](_0x4862c9),'rangeExact':_0x7198c6+0x1});}),'replacement':!![],'displayRoll':!![],'img':_0x2423fe};if(_0x650a30['defaultPermission']!=null)_0x3f1f36[_0x507ebc(0x1aa)]={'default':_0x650a30[_0x507ebc(0x1c2)]};else{if(_0x650a30[_0x507ebc(0x1ac)])_0x3f1f36[_0x507ebc(0x1aa)]={'default':Config[_0x507ebc(0x195)](_0x507ebc(0x187),'permissions')};}return _0x3f1f36;}static async[_0x2dbe37(0x1a3)]({type:_0x528c4c,text:_0x28c7ed,resultId:_0x2e3c99,collection:_0x1cb3b1,rangeLow:_0x50757b,rangeHigh:_0x2cbeba,rangeExact:_0x1134a6,img:img=_0x2dbe37(0x1b4),flags:flags={}}){const _0xcffd50=_0x2dbe37;if(_0x1134a6!=null&&(_0x50757b!=null||_0x2cbeba!=null))throw new Error(_0xcffd50(0x1a6));return{'id':foundry[_0xcffd50(0x17d)][_0xcffd50(0x19e)](),'resultId':_0x2e3c99,'collection':_0x1cb3b1,'flags':flags,'type':_0x528c4c,'text':_0x28c7ed,'img':await Vetools[_0xcffd50(0x1b5)](img),'weight':0x1,'range':[_0x50757b??_0x1134a6,_0x2cbeba??_0x1134a6],'drawn':![]};}static['getMaxTableRange'](_0x48f8d1){const _0x44a011=_0x2dbe37;return Math[_0x44a011(0x1b1)](0x0,..._0x48f8d1[_0x44a011(0x1be)][_0x44a011(0x1bf)](_0x56cbe7=>_0x56cbe7[_0x44a011(0x175)][_0x44a011(0x1a5)])[_0x44a011(0x181)]());}static[_0x2dbe37(0x1a4)](_0x4d8e9d){const _0x3c776a=_0x2dbe37;return _0x4d8e9d[_0x3c776a(0x1ca)](/{@(?:dice|damage) ([^}]+)}/gi,(..._0x42dc5e)=>{const _0x2a1093=_0x3c776a,[_0x35b1b8,_0x465d8b]=Renderer[_0x2a1093(0x198)](_0x42dc5e[0x1]),_0x46232c=Vetools[_0x2a1093(0x19d)](_0x35b1b8);return'[[/r\x20'+_0x46232c+']]'+(_0x465d8b&&_0x46232c[_0x2a1093(0x1b3)]()[_0x2a1093(0x1ae)]()!==_0x465d8b[_0x2a1093(0x1b3)]()[_0x2a1093(0x1ae)]()?'\x20('+_0x465d8b+')':'');});}static async[_0x2dbe37(0x1a8)](_0x529043,_0xe13234){const _0x5794b2=_0x2dbe37;_0xe13234=_0xe13234||{};const _0x39bc89=MiscUtil['copy'](_0x529043);delete _0x39bc89[_0x5794b2(0x17f)],_0x39bc89[_0x5794b2(0x1c5)]=_0x39bc89['type']||_0x5794b2(0x1a1);const _0x42a6ab=await UtilDataConverter[_0x5794b2(0x18e)](()=>{const _0x3bfd2f=_0x5794b2;return _0x3bfd2f(0x189)+Renderer[_0x3bfd2f(0x195)]()[_0x3bfd2f(0x178)](!![])[_0x3bfd2f(0x1ba)](_0x39bc89)+_0x3bfd2f(0x17c);}),_0x165d18=await this[_0x5794b2(0x1af)](_0x529043,{'propCompendium':_0x5794b2(0x1a1)}),_0xbcf811={'name':UtilApplications[_0x5794b2(0x191)](UtilDataConverter[_0x5794b2(0x199)](_0x529043)),'permission':{'default':0x0},'entryTime':Date['now'](),'content':_0x42a6ab,'img':_0x165d18};if(_0xe13234[_0x5794b2(0x1c2)]!=null)_0xbcf811[_0x5794b2(0x1aa)]={'default':_0xe13234['defaultPermission']};else{if(_0xe13234[_0x5794b2(0x1ac)])_0xbcf811[_0x5794b2(0x1aa)]={'default':Config['get'](_0x5794b2(0x187),_0x5794b2(0x188))};}return _0xbcf811;}}export{DataConverterTable};