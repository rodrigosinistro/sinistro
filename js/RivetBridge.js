function _0x331e(){const _0x4ca21e=['dice','Rivet','CHAT_MESSAGE_TYPES','textarea.rivet-transfer','get','trim','parse','init','getImporter','import','_pHandleEntityMessage','error','\x22\x20to\x20actor\x20\x22','settings','actor','users','21jhZexG','Unhandled\x20Rivet\x20message\x20with\x20type\x20\x22','ROLL','contents','_pHandleCurrencyMessage','1622RyJDTz','8814050qPNalw','TASK_EXIT_FAILED','name','224070PWaoaZ','402044fzuKGg','5etools.blacklist.excludes','getDisplayCurrency','isWhisper','485693AaYoXb','last','options','_pHandleSpecialMessage_5etools_lootgen_loot','scenes','map','isGM','</div>','page','Received\x20Rivet\x20message\x20(JSON)','170VhDubD','96rxIfKf','toMessage','minimumRole','doShowImportedNotification','WHISPER','226194pOePdT','./ChooseImporter.js','log','rolledBy','Actor','./LootGeneratorApp.js','\x22!\x20You\x20may\x20need\x20to\x20update\x20your\x20extension.','_handleRollMessage','_handlePacket','tokens','isTemp','label','exec','warn','pInit','user','groups','create','entity','info','type','userId','You\x20do\x20not\x20have\x20the\x20role\x20required!','_getTargetActor','targetActorId','addEventListener','role','Received\x20Rivet\x20message\x20(text)','64UTXSvx','roll','currency','372wkKEoS','162117dKXHCI','Plutonium\x20does\x20not\x20yet\x20support\x20entities\x20from\x20\x22','tokenId','<div>Currency:\x20','_pHandleSpecialMessage_5etools_blacklist_excludes','pAddCurrencyToActor','sceneId','data','instance','pSaveState','notifications','val','253IuQbzV'];_0x331e=function(){return _0x4ca21e;};return _0x331e();}const _0x361eb6=_0x41d3;(function(_0x233247,_0x53e36e){const _0x51dcae=_0x41d3,_0x16a9f4=_0x233247();while(!![]){try{const _0x51c71a=parseInt(_0x51dcae(0x1b4))/0x1*(-parseInt(_0x51dcae(0x17f))/0x2)+-parseInt(_0x51dcae(0x17a))/0x3*(parseInt(_0x51dcae(0x184))/0x4)+parseInt(_0x51dcae(0x192))/0x5*(parseInt(_0x51dcae(0x198))/0x6)+-parseInt(_0x51dcae(0x180))/0x7+parseInt(_0x51dcae(0x193))/0x8*(-parseInt(_0x51dcae(0x1b8))/0x9)+parseInt(_0x51dcae(0x183))/0xa*(parseInt(_0x51dcae(0x1c4))/0xb)+-parseInt(_0x51dcae(0x1b7))/0xc*(-parseInt(_0x51dcae(0x188))/0xd);if(_0x51c71a===_0x53e36e)break;else _0x16a9f4['push'](_0x16a9f4['shift']());}catch(_0x4c961a){_0x16a9f4['push'](_0x16a9f4['shift']());}}}(_0x331e,0xb0e33));import{Config}from'./Config.js';import{LGT}from'./Util.js';import{UtilApplications}from'./UtilApplications.js';import{ActorCharactermancerSourceSelector}from'./ActorCharactermancer.js';function _0x41d3(_0x92d0eb,_0x14a7c2){const _0x331e90=_0x331e();return _0x41d3=function(_0x41d35a,_0x5bdd54){_0x41d35a=_0x41d35a-0x174;let _0x5cebe2=_0x331e90[_0x41d35a];return _0x5cebe2;},_0x41d3(_0x92d0eb,_0x14a7c2);}import{UtilActors}from'./UtilActors.js';import{UtilWorldContentBlacklist}from'./UtilWorldContentBlacklist.js';class RivetBridge{static[_0x361eb6(0x1cc)](){const _0xec7e24=_0x361eb6;window[_0xec7e24(0x1b1)]('rivet.receive',_0x462989=>{const _0x575001=_0xec7e24;return console[_0x575001(0x19a)](...LGT,_0x575001(0x191)),this[_0x575001(0x1a0)](_0x462989['detail']);}),window['addEventListener']('rivet.receive-text',()=>{const _0x2e7f2f=_0xec7e24;console[_0x2e7f2f(0x19a)](...LGT,_0x2e7f2f(0x1b3));const _0x53545d=$(_0x2e7f2f(0x1c8)),_0x3ad199=_0x53545d[_0x2e7f2f(0x189)]()[_0x2e7f2f(0x1c3)]();return _0x53545d['remove'](),this[_0x2e7f2f(0x1a0)](JSON[_0x2e7f2f(0x1cb)](_0x3ad199));});}static[_0x361eb6(0x1a0)](_0x2ed87e){const _0x524f4e=_0x361eb6;switch(_0x2ed87e[_0x524f4e(0x1ac)]){case _0x524f4e(0x1b5):return this[_0x524f4e(0x19f)](_0x2ed87e);case _0x524f4e(0x1aa):return this[_0x524f4e(0x174)](_0x2ed87e);case _0x524f4e(0x1b6):return this[_0x524f4e(0x17e)](_0x2ed87e);case'5etools.lootgen.loot':return this[_0x524f4e(0x18b)](_0x2ed87e);case _0x524f4e(0x185):return this['_pHandleSpecialMessage_5etools_blacklist_excludes'](_0x2ed87e);default:ui['notifications']['error'](_0x524f4e(0x17b)+_0x2ed87e[_0x524f4e(0x1ac)]+_0x524f4e(0x19e));}}static[_0x361eb6(0x19f)](_0x2768b0){const _0x50a9fd=_0x361eb6,_0x3f4a4f=_0x2768b0[_0x50a9fd(0x1bf)];if(!_0x2768b0['settings']['isSendRolls'])return;const _0x2174f9=new Roll(_0x3f4a4f[_0x50a9fd(0x1c5)]);_0x2174f9[_0x50a9fd(0x194)]({'speaker':{'alias':_0x3f4a4f[_0x50a9fd(0x19b)]},'flavor':_0x3f4a4f[_0x50a9fd(0x1a3)],'rollMode':_0x2768b0[_0x50a9fd(0x177)][_0x50a9fd(0x187)]?CONST['CHAT_MESSAGE_TYPES'][_0x50a9fd(0x197)]:CONST[_0x50a9fd(0x1c7)][_0x50a9fd(0x17c)]});}static async[_0x361eb6(0x174)](_0x1bdc42){const _0x451120=_0x361eb6,_0xbffb44=Config[_0x451120(0x1c9)](_0x451120(0x1ce),_0x451120(0x195));if(game[_0x451120(0x1a7)][_0x451120(0x1b2)]<_0xbffb44)return ui['notifications'][_0x451120(0x1a5)](_0x451120(0x1ae));const _0xedfad7=_0x1bdc42['data'],_0x5e34c1=this['_getTargetActor'](),{ChooseImporter:_0xaf7dbf}=await import(_0x451120(0x199)),_0x1feddd=_0xaf7dbf[_0x451120(0x1cd)](_0xedfad7?.[_0x451120(0x1aa)]?.['__prop']||_0xedfad7[_0x451120(0x190)],_0x5e34c1);if(!_0x1feddd)return ui[_0x451120(0x1c2)][_0x451120(0x175)](_0x451120(0x1b9)+(_0xedfad7?.['entity']?.['__prop']||_0xedfad7[_0x451120(0x190)])+'\x22!\x20You\x20may\x20need\x20to\x20update\x20your\x20extension.');try{await _0x1feddd[_0x451120(0x1a6)]();const _0x5d8d2e={..._0xedfad7[_0x451120(0x18a)]||{}};if(_0xedfad7[_0x451120(0x1a2)])_0x5d8d2e[_0x451120(0x1a2)]=!![];const _0x5e35f2=await _0x1feddd['pImportEntry'](_0xedfad7['entity'],_0x5d8d2e);UtilApplications[_0x451120(0x196)](_0x5e35f2);}catch(_0x32f720){UtilApplications['doShowImportedNotification']({'entity':_0xedfad7,'status':UtilApplications[_0x451120(0x181)]}),setTimeout(()=>{throw _0x32f720;});}}static async[_0x361eb6(0x17e)](_0x43008c){const _0xedb764=_0x361eb6,_0x23206b=_0x43008c[_0xedb764(0x1bf)],_0x3ad32d=this['_getTargetActor']();if(!_0x3ad32d){await ChatMessage[_0xedb764(0x1a9)]({'content':_0xedb764(0x1bb)+Parser[_0xedb764(0x186)](_0x23206b[_0xedb764(0x1b6)])+_0xedb764(0x18f),'user':game[_0xedb764(0x1ad)],'type':0x4,'speaker':{'alias':_0xedb764(0x1c6)},'whisper':game[_0xedb764(0x179)][_0xedb764(0x17d)]['filter'](_0x4a926f=>_0x4a926f[_0xedb764(0x18e)]||_0x4a926f===game[_0xedb764(0x1a7)])[_0xedb764(0x18d)](_0x1cb2e2=>_0x1cb2e2['id'])});return;}try{await UtilActors[_0xedb764(0x1bd)]({'currency':_0x23206b['currency'],'actor':_0x3ad32d}),ui['notifications'][_0xedb764(0x1ab)]('Applied\x20currency\x20\x22'+Parser[_0xedb764(0x186)](_0x23206b[_0xedb764(0x1b6)])+_0xedb764(0x176)+_0x3ad32d[_0xedb764(0x182)]+'\x22');}catch(_0x5d271e){ui['notifications'][_0xedb764(0x175)]('Failed\x20to\x20apply\x20currency\x20\x22'+Parser['getDisplayCurrency'](_0x23206b[_0xedb764(0x1b6)])+_0xedb764(0x176)+_0x3ad32d[_0xedb764(0x182)]+'\x22'),setTimeout(()=>{throw _0x5d271e;});}}static async[_0x361eb6(0x18b)](_0x17dd76){const _0x54b782=_0x361eb6,{LootGeneratorApp:_0x3f2041}=await import(_0x54b782(0x19d)),_0x1992ee=_0x17dd76[_0x54b782(0x1bf)],_0x504aec=this[_0x54b782(0x1af)]();await _0x3f2041['pImportLoot']({'loot':_0x1992ee,'actor':_0x504aec,'isLogToChat':!![],'isNotify':!![]});}static async[_0x361eb6(0x1bc)](_0x244e00){const _0x1e7983=_0x361eb6;await UtilWorldContentBlacklist[_0x1e7983(0x1c1)](_0x244e00['data'],{'message':'Updated\x20content\x20blacklist!'});}static[_0x361eb6(0x1af)](){const _0x5ea262=_0x361eb6,_0x2cfb3c=(Config[_0x5ea262(0x1c9)]('rivet',_0x5ea262(0x1b0))||'')[_0x5ea262(0x1ca)]();if(!_0x2cfb3c)return null;const _0x481895=/^Scene\.(?<sceneId>[^.]+)\.Token\.(?<tokenId>[^.]+)$/[_0x5ea262(0x1a4)](_0x2cfb3c);if(!_0x481895)return CONFIG[_0x5ea262(0x19c)]['collection'][_0x5ea262(0x1c0)]['get'](_0x2cfb3c);const _0x54b78e=game[_0x5ea262(0x18c)][_0x5ea262(0x1c9)](_0x481895['groups'][_0x5ea262(0x1be)]);if(!_0x54b78e)return null;const _0xcf33a=_0x54b78e[_0x5ea262(0x1a1)]['get'](_0x481895[_0x5ea262(0x1a8)][_0x5ea262(0x1ba)]);if(!_0xcf33a)return null;return _0xcf33a[_0x5ea262(0x178)];}}export{RivetBridge};