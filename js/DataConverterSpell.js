const _0x30567f=_0x4081;(function(_0x35e7f5,_0x4839a8){const _0x2b1859=_0x4081,_0x3fcc8d=_0x35e7f5();while(!![]){try{const _0xab9ed1=parseInt(_0x2b1859(0x27b))/0x1+-parseInt(_0x2b1859(0x1fe))/0x2*(-parseInt(_0x2b1859(0x2bc))/0x3)+-parseInt(_0x2b1859(0x2d5))/0x4+parseInt(_0x2b1859(0x285))/0x5*(-parseInt(_0x2b1859(0x230))/0x6)+parseInt(_0x2b1859(0x263))/0x7+parseInt(_0x2b1859(0x25a))/0x8*(-parseInt(_0x2b1859(0x229))/0x9)+parseInt(_0x2b1859(0x24d))/0xa*(parseInt(_0x2b1859(0x28b))/0xb);if(_0xab9ed1===_0x4839a8)break;else _0x3fcc8d['push'](_0x3fcc8d['shift']());}catch(_0x503af2){_0x3fcc8d['push'](_0x3fcc8d['shift']());}}}(_0x3dbe,0x84bf1));import{Vetools}from'./Vetools.js';import{UtilActors}from'./UtilActors.js';import{Config}from'./Config.js';import{SharedConsts}from'../shared/SharedConsts.js';import{UtilApplications}from'./UtilApplications.js';import{DataConverter}from'./DataConverter.js';import{UtilCompendium}from'./UtilCompendium.js';import{UtilActiveEffects}from'./UtilActiveEffects.js';function _0x3dbe(){const _0x4586fb=['icons/magic/unholy/silhouette-evil-horned-giant.webp','entriesHigherLevel','type','actor','_pGetSpellItem_mutMaterials','<div><span\x20class=\x22bold\x22>Classes:\x20</span>','spell','map','clamped','2VotJdn','innate','options','\x20+\x20@mod','_pGetSpellItem_mutDamageAndFormula','_pGetSaveImagePath','_pGetSpellEffects','parseScaleDice','toLowerCase','unit','icons/magic/fire/projectile-fireball-orange-yellow.webp','_pGetSpellItem_parseAndAddDamage','util','pSetSpellItemIsPrepared','srd5e','activationCost','_pGetSpellItem_getHigherLevelMeta','icons/magic/defensive/illusion-evasion-echo-purple.webp','components','join','targetUnits','prompt','amount','includes','permission','cantrip','getNameWithSourcePart','getSrdCompendiumEntity','splitFirstSpace','_pGetSpellItem_mutSchool','MODULE_NAME','getActorSpell','ability','_getReDiceYourSpellcastingMod','items','_PassiveEntryParseStateSpell','pHasSpellSideLoadedEffects','_pGetEffectsRawSideLoaded_','_pGetSpellItem_mutPreparationMode','isMidiQolActive','year','_SIDE_LOAD_OPTS','stripTags','9RnTeHa','round','foundrySpell','actionType','isAllowSpellPoints','text','activationCondition','1265322kwUbbH','self','pUpdateDocument','reaction','distance','formula','_pGetImgCustom','healing','get','getMetricUnitDistance','materials','getMetricNumberDistance','damageParts','_pGetSpellItem_mut_srdData','pGetIconImage','target.units','saveAbility','_pGetFlagsSideLoaded','instant','_pGetSpellItem_mutSave','cost','defaultPermission','rangeUnits','mutEffectsDisabledTransfer','consumeAmount','isCustomDamageParts','findIndex','fromClassList','name','14943730VnYfDW','icons/magic/movement/abstract-ribbons-red-orange.webp','_pGetDataSideLoaded','_pGetSpellItem_mutConsumes','rangeLong','number','save','find','timed','atwill','permissions','getSpellPointsKey','parentClassName','8651152uVuUrB','addPerLevel','saveScaling','targetType','hour','importSpell','spellPointsItemId','flags','icons/magic/defensive/shield-barrier-blue.webp','4936232zWCBcq','source','MODULE_NAME_FAKE','charges','damageTuples','getExpandedEffects','VET_SPELL_SCHOOL_TO_ABV','week','uses','sort','perm','pGetSpellItemEffects','targetValue','special','stringify','copy','pInit','parentSubclassName','touch','range','miscTags','_pGetSpellItem_mutRangeTarget','icon','none','940150GiJxvt','isImportDescription','_getConfigKeyIsSpellPoints','icons/magic/unholy/hand-fire-skeleton-pink.webp','substring','activationType','reactionmanual','min','forEach','pGetEntryDescription','25gFAKPK','modules/','target.value','@mod','scaling','_pGetSpellItem_mutDuration','11PffxQY','nameSuffix','label','filter','isAddPermission','getItemSource','isActorItemNpc','minute','preparation','spec','level','duration','target','slice','day','URL_TO_HASH_BUILDER','prepared','getConsumedSheetItem','isStrictMatching','spMainClassesToFull','replace','always','parentClassSource','rsak','consumeType','_pGetDescription','_getImgFallback','isPrepared','add','pGetWithDescriptionPlugins','data','spClassesToCurrentAndLegacy','length','_pGetSpellItem_mutActivation','PG_SPELLS','isActorItem','parts','split','getSourceWithPagePart','rangeShort','getThenSetCopy','ritual','savingThrow','push',')\x20*\x20','turn','usesPer','consumeTarget','_pGetSpellItem_mutActionType','1734123mbLCQG','consume','msak','effects','durationValue','damage','durationUnit','condition','C_SPELL_POINTS_RESOURCE__SHEET_ITEM','permanent','scalingLevelDice','heal','_PassiveEntryParseState','getCompendiumEntity','_IMG_FALLBACK','school','cantripScaling','time','has','castAtLevel','preparationMode','when\x20you\x20reach\x205th\x20level','getSpellPointsResource','vetConsumes','ranged\x20spell\x20attack','4152728NKIqwL','last'];_0x3dbe=function(){return _0x4586fb;};return _0x3dbe();}import{UtilDataConverter}from'./UtilDataConverter.js';function _0x4081(_0x4a243d,_0x2c92a2){const _0x3dbe9e=_0x3dbe();return _0x4081=function(_0x408160,_0x417613){_0x408160=_0x408160-0x1f4;let _0x56695e=_0x3dbe9e[_0x408160];return _0x56695e;},_0x4081(_0x4a243d,_0x2c92a2);}import{ConfigConsts}from'./ConfigConsts.js';import{UtilDocuments}from'./UtilDocuments.js';import{UtilCompat}from'./UtilCompat.js';class DataConverterSpell extends DataConverter{static [_0x30567f(0x227)]={'propBrew':_0x30567f(0x22b),'fnLoadJson':Vetools['pGetSpellSideData'],'propJson':_0x30567f(0x1fb)};static [_0x30567f(0x2ca)]=_0x30567f(0x286)+SharedConsts[_0x30567f(0x21c)]+'/media/icon/scroll-unfurled.svg';static[_0x30567f(0x27d)](_0x4ac7db){const _0x17df92=_0x30567f;if(_0x4ac7db[_0x17df92(0x291)])return'spellPointsModeNpc';return Config[_0x17df92(0x258)]({'actorType':_0x4ac7db[_0x17df92(0x1f8)]?.[_0x17df92(0x1f7)]});}static[_0x30567f(0x22d)](_0x3a6aa3,_0x30b114){const _0x27f860=_0x30567f;return _0x30b114['target']==null&&_0x30b114[_0x27f860(0x2d3)]==null&&_0x3a6aa3!==0x0&&Config[_0x27f860(0x238)](_0x27f860(0x25f),this[_0x27f860(0x27d)](_0x30b114))!==ConfigConsts['C_SPELL_POINTS_MODE__DISABLED'];}static [_0x30567f(0x221)]=class extends this[_0x30567f(0x2c8)]{constructor({entry:entry,img:img},opts){const _0x409b4d=_0x30567f;super({'entry':entry,'img':img},opts);let {school:school,materials:materials,preparationMode:preparationMode,isPrepared:isPrepared,ability:ability}=opts;this[_0x409b4d(0x2cb)]=school,this[_0x409b4d(0x23a)]=materials,this[_0x409b4d(0x2d0)]=preparationMode,this['isPrepared']=isPrepared;if(ability!==undefined)this[_0x409b4d(0x25c)]=ability;this[_0x409b4d(0x249)]=![];}};static async['pGetSpellItem'](_0x141f7c,_0x391add){const _0x3bfc5a=_0x30567f;_0x391add=_0x391add||{};const _0x21d27e=new this[(_0x3bfc5a(0x221))]({'entry':_0x141f7c},_0x391add);await _0x21d27e[_0x3bfc5a(0x273)]({'isSkipDescription':!![],'isSkipImg':!![]});const _0x4ce0b4=await UtilCompendium[_0x3bfc5a(0x219)](_0x3bfc5a(0x1fb),_0x141f7c),_0x47b5ed=await this[_0x3bfc5a(0x2a4)](_0x141f7c),_0x128053=JSON[_0x3bfc5a(0x271)](_0x141f7c['entries']);this[_0x3bfc5a(0x224)]({'spell':_0x141f7c,'opts':_0x391add,'state':_0x21d27e}),this[_0x3bfc5a(0x2bb)]({'spell':_0x141f7c,'opts':_0x391add,'entriesStr':_0x128053,'state':_0x21d27e}),this[_0x3bfc5a(0x21b)]({'spell':_0x141f7c,'opts':_0x391add,'state':_0x21d27e}),this[_0x3bfc5a(0x1f9)]({'spell':_0x141f7c,'opts':_0x391add,'state':_0x21d27e}),this[_0x3bfc5a(0x28a)]({'spell':_0x141f7c,'opts':_0x391add,'state':_0x21d27e}),this['_pGetSpellItem_mutRangeTarget']({'spell':_0x141f7c,'opts':_0x391add,'state':_0x21d27e}),this[_0x3bfc5a(0x202)]({'spell':_0x141f7c,'opts':_0x391add,'entriesStr':_0x128053,'srdData':_0x4ce0b4,'state':_0x21d27e}),this[_0x3bfc5a(0x243)]({'spell':_0x141f7c,'opts':_0x391add,'state':_0x21d27e}),this['_pGetSpellItem_mutConsumes']({'spell':_0x141f7c,'opts':_0x391add,'state':_0x21d27e}),this[_0x3bfc5a(0x2ac)]({'spell':_0x141f7c,'opts':_0x391add,'state':_0x21d27e});const _0x4a520e=await this[_0x3bfc5a(0x203)](_0x141f7c,{'propCompendium':_0x3bfc5a(0x1fb)});this[_0x3bfc5a(0x23d)]({'spell':_0x141f7c,'opts':_0x391add,'srdData':_0x4ce0b4,'state':_0x21d27e});const _0x59d91f=await this[_0x3bfc5a(0x24f)](_0x141f7c,{'targetUnits':_0x21d27e[_0x3bfc5a(0x212)]}),_0x44cd94=await this[_0x3bfc5a(0x241)](_0x141f7c),_0x5714bc={'name':UtilApplications['getCleanEntityName'](''+UtilDataConverter[_0x3bfc5a(0x218)](_0x141f7c,{'isActorItem':_0x391add[_0x3bfc5a(0x2ae)]})+(_0x391add[_0x3bfc5a(0x28c)]||'')),'type':_0x3bfc5a(0x1fb),'data':{'source':UtilDataConverter[_0x3bfc5a(0x2b1)](_0x141f7c),'description':{'value':_0x47b5ed,'chat':'','unidentified':''},'actionType':_0x21d27e[_0x3bfc5a(0x22c)],'level':this['_pGetSpellItem_getLevel'](_0x141f7c),'school':_0x21d27e[_0x3bfc5a(0x2cb)],'components':{'value':'','vocal':_0x141f7c[_0x3bfc5a(0x210)]&&_0x141f7c[_0x3bfc5a(0x210)]['v'],'somatic':_0x141f7c[_0x3bfc5a(0x210)]&&_0x141f7c[_0x3bfc5a(0x210)]['s'],'material':!!(_0x141f7c[_0x3bfc5a(0x210)]&&_0x141f7c['components']['m']),'ritual':_0x141f7c['meta']&&_0x141f7c['meta'][_0x3bfc5a(0x2b4)],'concentration':!!MiscUtil[_0x3bfc5a(0x238)](_0x141f7c,_0x3bfc5a(0x296),'0','concentration')},'materials':{'value':_0x21d27e[_0x3bfc5a(0x23a)],'consumed':!!MiscUtil[_0x3bfc5a(0x238)](_0x141f7c,_0x3bfc5a(0x210),'m',_0x3bfc5a(0x2bd)),'cost':Math[_0x3bfc5a(0x22a)]((MiscUtil[_0x3bfc5a(0x238)](_0x141f7c,_0x3bfc5a(0x210),'m',_0x3bfc5a(0x244))||0x0)/0x64),'supply':0x0},'target':{'value':_0x21d27e[_0x3bfc5a(0x26f)],'units':_0x21d27e[_0x3bfc5a(0x212)],'type':_0x21d27e[_0x3bfc5a(0x25d)]},'range':{'value':_0x21d27e[_0x3bfc5a(0x2b2)],'units':_0x21d27e[_0x3bfc5a(0x246)],'long':_0x21d27e[_0x3bfc5a(0x251)]},'activation':{'type':_0x21d27e[_0x3bfc5a(0x280)],'cost':_0x21d27e[_0x3bfc5a(0x20d)],'condition':_0x21d27e['activationCondition']},'duration':{'value':_0x21d27e['durationValue'],'units':_0x21d27e[_0x3bfc5a(0x2c2)]},'damage':{'parts':_0x21d27e[_0x3bfc5a(0x23c)],'versatile':''},'scaling':{'mode':_0x21d27e[_0x3bfc5a(0x2cc)]?_0x3bfc5a(0x217):_0x21d27e[_0x3bfc5a(0x289)]?_0x3bfc5a(0x295):_0x3bfc5a(0x27a),'formula':_0x21d27e['cantripScaling']||_0x21d27e[_0x3bfc5a(0x289)]||''},'save':{'ability':_0x21d27e[_0x3bfc5a(0x240)],'dc':null,'scaling':_0x21d27e[_0x3bfc5a(0x25c)]},'ability':_0x21d27e['ability'],'uses':{'value':_0x21d27e['usesValue'],'max':_0x21d27e['usesMax'],'per':_0x21d27e[_0x3bfc5a(0x2b9)]},'attackBonus':null,'chatFlavor':'','critical':{'threshold':null,'damage':''},'formula':_0x21d27e[_0x3bfc5a(0x235)],'preparation':{'mode':_0x21d27e[_0x3bfc5a(0x2d0)],'prepared':!!_0x21d27e['isPrepared']},'consume':{'type':_0x21d27e[_0x3bfc5a(0x2a3)],'target':_0x21d27e[_0x3bfc5a(0x2ba)],'amount':_0x21d27e[_0x3bfc5a(0x248)]},..._0x59d91f||{}},'img':_0x4a520e,'flags':{...this['_getSpellFlags'](_0x141f7c,_0x391add),..._0x44cd94},'effects':await this[_0x3bfc5a(0x204)](_0x141f7c,_0x4ce0b4,_0x4a520e)};if(_0x391add[_0x3bfc5a(0x245)]!=null)_0x5714bc[_0x3bfc5a(0x216)]={'default':_0x391add['defaultPermission']};else{if(_0x391add[_0x3bfc5a(0x28f)])_0x5714bc['permission']={'default':Config[_0x3bfc5a(0x238)](_0x3bfc5a(0x25f),_0x3bfc5a(0x257))};}const _0x399f47=await UtilCompendium[_0x3bfc5a(0x2c9)](_0x3bfc5a(0x1fb),_0x141f7c);if(_0x399f47)return[['data',_0x3bfc5a(0x293)],[_0x3bfc5a(0x2a9),_0x3bfc5a(0x26b)],[_0x3bfc5a(0x2a9),_0x3bfc5a(0x2bd)],['data',_0x3bfc5a(0x21e)],['data',_0x3bfc5a(0x253),_0x3bfc5a(0x289)],['permission'],[_0x3bfc5a(0x261),_0x3bfc5a(0x20c)]][_0x3bfc5a(0x283)](_0x5f202c=>{const _0x3e2cdd=_0x3bfc5a;MiscUtil[_0x3e2cdd(0x2b3)](_0x5714bc,_0x399f47,..._0x5f202c);}),_0x399f47;return _0x5714bc;}static[_0x30567f(0x224)]({spell:_0x396a34,opts:_0x2e156f,state:_0x57ef80}){const _0x3766fa=_0x30567f;Config[_0x3766fa(0x238)](_0x3766fa(0x25f),this[_0x3766fa(0x27d)](_0x2e156f))===ConfigConsts['C_SPELL_POINTS_MODE__ENABLED']&&_0x396a34[_0x3766fa(0x295)]!==0x0&&(!_0x57ef80['preparationMode']||_0x57ef80[_0x3766fa(0x2d0)]===_0x3766fa(0x29b)||_0x57ef80[_0x3766fa(0x2d0)]===_0x3766fa(0x2a0))&&(_0x57ef80[_0x3766fa(0x2d0)]=_0x3766fa(0x256));if(_0x57ef80[_0x3766fa(0x2d0)]===undefined)_0x57ef80[_0x3766fa(0x2d0)]=_0x396a34[_0x3766fa(0x295)]===0x0?'always':_0x3766fa(0x29b);if(_0x57ef80[_0x3766fa(0x2a6)]===undefined)_0x57ef80['isPrepared']=_0x396a34['level']===0x0;}static['_pGetSpellItem_mutActionType']({spell:_0x3c0c01,opts:_0x4c753d,entriesStr:_0x287a25,state:_0x12dcf8}){const _0xb3a7a4=_0x30567f;let _0xd8ee2d='';if(_0x3c0c01['miscTags']&&_0x3c0c01[_0xb3a7a4(0x277)][_0xb3a7a4(0x215)]('HL'))_0xd8ee2d=_0xb3a7a4(0x2c7);if(_0x3c0c01[_0xb3a7a4(0x2b5)]?.[_0xb3a7a4(0x2ab)])_0xd8ee2d=_0xb3a7a4(0x253);if(_0x287a25[_0xb3a7a4(0x206)]()[_0xb3a7a4(0x215)]('melee\x20spell\x20attack'))_0xd8ee2d=_0xb3a7a4(0x2be);if(_0x287a25[_0xb3a7a4(0x206)]()['includes'](_0xb3a7a4(0x2d4)))_0xd8ee2d=_0xb3a7a4(0x2a2);if(_0x12dcf8[_0xb3a7a4(0x22c)]===undefined)_0x12dcf8[_0xb3a7a4(0x22c)]=_0xd8ee2d||_0xb3a7a4(0x20a);}static[_0x30567f(0x21b)]({spell:_0x3cd1d4,opts:_0x59ab52,state:_0x11324c}){const _0x5db639=_0x30567f;_0x11324c[_0x5db639(0x2cb)]=UtilActors[_0x5db639(0x269)][_0x3cd1d4[_0x5db639(0x2cb)]]||'';}static[_0x30567f(0x1f9)]({spell:_0x4c9d5f,opts:_0x145a31,state:_0x52a780}){const _0x361220=_0x30567f;_0x52a780['materials']=_0x4c9d5f[_0x361220(0x210)]?.['m']?_0x4c9d5f['components']['m']!==!![]?''+(_0x4c9d5f[_0x361220(0x210)]['m'][_0x361220(0x22e)]||_0x4c9d5f[_0x361220(0x210)]['m']):'':'';}static[_0x30567f(0x28a)]({spell:_0x344ca2,opts:_0x46437b,state:_0x5c88ee}){const _0x1e898a=_0x30567f;let _0x337f7e=0x0,_0x13608c='';const _0x199789=_0x344ca2[_0x1e898a(0x296)][0x0];switch(_0x199789[_0x1e898a(0x1f7)]){case _0x1e898a(0x242):_0x13608c='inst';break;case _0x1e898a(0x255):{switch(_0x199789['duration']['type']){case _0x1e898a(0x2b8):_0x13608c=_0x1e898a(0x2b8),_0x337f7e=_0x199789[_0x1e898a(0x296)][_0x1e898a(0x214)];break;case'round':_0x13608c=_0x1e898a(0x22a),_0x337f7e=_0x199789[_0x1e898a(0x296)][_0x1e898a(0x214)];break;case _0x1e898a(0x292):_0x13608c='minute',_0x337f7e=_0x199789[_0x1e898a(0x296)][_0x1e898a(0x214)];break;case'hour':_0x13608c=_0x1e898a(0x25e),_0x337f7e=_0x199789['duration'][_0x1e898a(0x214)];break;case'day':_0x13608c=_0x1e898a(0x299),_0x337f7e=_0x199789['duration']['amount'];break;case _0x1e898a(0x26a):_0x13608c='day',_0x337f7e=_0x199789[_0x1e898a(0x296)][_0x1e898a(0x214)]*0x7;break;case _0x1e898a(0x226):_0x13608c=_0x1e898a(0x226),_0x337f7e=_0x199789[_0x1e898a(0x296)][_0x1e898a(0x214)];break;}break;}case _0x1e898a(0x2c5):_0x13608c=_0x1e898a(0x26d);break;case _0x1e898a(0x270):_0x13608c=_0x1e898a(0x294);break;}if(_0x5c88ee[_0x1e898a(0x2c0)]===undefined)_0x5c88ee[_0x1e898a(0x2c0)]=_0x337f7e;if(_0x5c88ee[_0x1e898a(0x2c2)]===undefined)_0x5c88ee[_0x1e898a(0x2c2)]=_0x13608c;}static[_0x30567f(0x278)]({spell:_0x44fb87,opts:_0xf7172d,state:_0x103f42}){const _0x14f5f3=_0x30567f;let _0x290a90=0x0,_0x472822='',_0x5bf990=0x0,_0x5ad056='',_0x1b5179='';switch(_0x44fb87['range']['type']){case RNG_SPECIAL:_0x472822=_0x14f5f3(0x294);break;case RNG_POINT:{const _0x47f111=_0x44fb87['range'][_0x14f5f3(0x234)];switch(_0x47f111[_0x14f5f3(0x1f7)]){case RNG_SELF:{_0x5ad056=_0x14f5f3(0x231),_0x1b5179=_0x14f5f3(0x231),_0x472822=_0x14f5f3(0x231);break;}case RNG_UNLIMITED:case RNG_UNLIMITED_SAME_PLANE:case RNG_SIGHT:case RNG_SPECIAL:{_0x5ad056=_0x14f5f3(0x294),_0x472822=_0x14f5f3(0x294);break;}case RNG_TOUCH:{_0x5ad056=_0x14f5f3(0x275),_0x472822=_0x14f5f3(0x275);break;}case UNT_MILES:{_0x290a90=Config[_0x14f5f3(0x23b)]({'configGroup':_0x14f5f3(0x25f),'originalValue':_0x47f111['amount'],'originalUnit':UNT_MILES}),_0x472822=Config[_0x14f5f3(0x239)]({'configGroup':_0x14f5f3(0x25f),'originalUnit':UNT_MILES});break;}case UNT_FEET:default:{_0x290a90=Config[_0x14f5f3(0x23b)]({'configGroup':_0x14f5f3(0x25f),'originalValue':_0x47f111[_0x14f5f3(0x214)],'originalUnit':UNT_FEET}),_0x472822=Config[_0x14f5f3(0x239)]({'configGroup':_0x14f5f3(0x25f),'originalUnit':UNT_FEET});break;}}break;}case RNG_LINE:case RNG_CUBE:case RNG_CONE:case RNG_RADIUS:case RNG_SPHERE:case RNG_HEMISPHERE:case RNG_CYLINDER:{_0x5bf990=Config['getMetricNumberDistance']({'configGroup':'importSpell','originalValue':_0x44fb87[_0x14f5f3(0x276)][_0x14f5f3(0x234)][_0x14f5f3(0x214)],'originalUnit':_0x44fb87[_0x14f5f3(0x276)]['distance'][_0x14f5f3(0x1f7)]}),_0x5ad056=Config[_0x14f5f3(0x239)]({'configGroup':_0x14f5f3(0x25f),'originalUnit':_0x44fb87[_0x14f5f3(0x276)]['distance'][_0x14f5f3(0x1f7)]});if(_0x44fb87['range']['type']===RNG_HEMISPHERE)_0x1b5179='sphere';else _0x1b5179=_0x44fb87[_0x14f5f3(0x276)][_0x14f5f3(0x1f7)];}}_0x103f42[_0x14f5f3(0x2b2)]=_0x290a90,_0x103f42[_0x14f5f3(0x246)]=_0x472822,_0x103f42[_0x14f5f3(0x26f)]=_0x5bf990,_0x103f42[_0x14f5f3(0x212)]=_0x5ad056,_0x103f42['targetType']=_0x1b5179;}static[_0x30567f(0x202)]({spell:_0x4bd982,opts:_0x2ec15d,entriesStr:_0x4d68f9,srdData:_0x38ea0a,state:_0x27a718}){const _0x253d82=_0x30567f;let _0x1462c5=[],_0x4a3489=null,_0x4fea16=null;if(_0x4bd982[_0x253d82(0x2c6)]){const _0xc9cbd9=[_0x4bd982['scalingLevelDice']]['flat'](),_0x2d1a14=_0x294b27=>Math[_0x253d82(0x282)](...Object['keys'](_0x294b27)[_0x253d82(0x1fc)](_0x31e724=>Number(_0x31e724))),_0x517d48=new RegExp('('+UtilActors['VALID_DAMAGE_TYPES'][_0x253d82(0x211)]('|')+')','i');_0x1462c5[_0x253d82(0x2b6)](..._0xc9cbd9['map'](_0x3259fa=>{const _0x1b5d37=_0x253d82,_0x13ffef=_0x2d1a14(_0x3259fa['scaling']),_0x117fd4=_0x3259fa[_0x1b5d37(0x289)][_0x13ffef],_0x150b0d=_0x517d48['exec'](_0x3259fa[_0x1b5d37(0x28d)]||'');return[(_0x117fd4||'')['replace'](/{{spellcasting_mod}}/g,_0x1b5d37(0x288)),_0x150b0d?_0x150b0d[0x1][_0x1b5d37(0x206)]():null];}));const _0x379682=_0xc9cbd9[0x0],_0x119dc9=_0x2d1a14(_0x379682[_0x253d82(0x289)]);_0x4a3489=_0x379682[_0x253d82(0x289)][_0x119dc9];}else{let _0x52522b=[];if(_0x4bd982['damageInflict']&&_0x4bd982['damageInflict'][_0x253d82(0x2ab)]){if(_0x4d68f9[_0x253d82(0x206)]()['includes'](_0x253d82(0x2d1))){const _0x1f901a=[];_0x4d68f9[_0x253d82(0x29f)](/\({@damage ([^}]+)}\)/g,(..._0x58964a)=>_0x1f901a[_0x253d82(0x2b6)](_0x58964a[0x1]));if(_0x1f901a['length']===0x3){const _0x1249a1=/(?:^|[^(]){@damage ([^}]+)}(?:[^)]|$)/['exec'](_0x4d68f9);if(_0x1249a1)_0x4a3489=_0x1249a1[0x1];else _0x4a3489=_0x1f901a[0x0];}}this[_0x253d82(0x209)](_0x4d68f9,_0x52522b);}if(_0x4bd982['miscTags']&&_0x4bd982[_0x253d82(0x277)]['some'](_0x456a1a=>_0x456a1a==='HL')){const _0x3b5345=['',_0x253d82(0x237)];_0x4d68f9[_0x253d82(0x29f)](this['_getReDiceYourSpellcastingMod'](),(..._0x26d126)=>{const _0x5bac45=_0x253d82,[,_0x451a0e,_0x32d815]=_0x26d126;_0x3b5345[0x0]=_0x451a0e;if(_0x32d815)_0x3b5345[0x0]=_0x3b5345[0x0]+_0x5bac45(0x201);}),_0x52522b[_0x253d82(0x2b6)](_0x3b5345);}const _0x34b9fa=this[_0x253d82(0x20e)]({'spell':_0x4bd982,'opts':_0x2ec15d,'damageTuples':_0x52522b,'isCustomDamageParts':_0x27a718[_0x253d82(0x249)],'scaling':_0x4fea16,'preparationMode':_0x27a718[_0x253d82(0x2d0)]});_0x34b9fa&&(_0x52522b=_0x34b9fa[_0x253d82(0x267)],_0x27a718[_0x253d82(0x249)]=_0x34b9fa['isCustomDamageParts'],_0x4fea16=_0x34b9fa[_0x253d82(0x289)]);if(!_0x52522b[_0x253d82(0x2ab)])this[_0x253d82(0x209)](_0x4d68f9,_0x52522b);_0x1462c5[_0x253d82(0x2b6)](..._0x52522b);}_0x1462c5=_0x1462c5[_0x253d82(0x28e)](Boolean);let _0x1e7517='';!_0x1462c5[_0x253d82(0x2ab)]&&!_0x27a718[_0x253d82(0x249)]&&!MiscUtil[_0x253d82(0x238)](_0x38ea0a,'data','damage',_0x253d82(0x2af))&&_0x4d68f9[_0x253d82(0x29f)](this[_0x253d82(0x21f)](),(..._0x39c80f)=>{const [,_0x36a3b2,_0x13dc50]=_0x39c80f;_0x1e7517=_0x36a3b2;if(_0x13dc50)_0x1e7517=_0x1e7517+'\x20+\x20@mod';});if(_0x27a718[_0x253d82(0x23c)]===undefined)_0x27a718[_0x253d82(0x23c)]=_0x1462c5;if(_0x27a718['cantripScaling']===undefined)_0x27a718[_0x253d82(0x2cc)]=_0x4a3489;if(_0x27a718['scaling']===undefined)_0x27a718[_0x253d82(0x289)]=_0x4fea16;if(_0x27a718[_0x253d82(0x235)]===undefined)_0x27a718['formula']=_0x1e7517;}static['_pGetSpellItem_mutSave']({spell:_0x2307a7,opts:_0x5431ed,state:_0x11bed4}){const _0x1ed866=_0x30567f;_0x2307a7[_0x1ed866(0x2b5)]?.[_0x1ed866(0x2ab)]&&(_0x11bed4['saveAbility']=_0x2307a7[_0x1ed866(0x2b5)][0x0][_0x1ed866(0x27f)](0x0,0x3)[_0x1ed866(0x206)]());if(_0x11bed4['saveScaling']===undefined)_0x11bed4['saveScaling']='spell';}static[_0x30567f(0x250)]({spell:_0x5a905f,opts:_0x3625d6,state:_0x200a2d}){const _0x2ba41c=_0x30567f;if(_0x3625d6['vetConsumes']){const _0x3ab183=DataConverter[_0x2ba41c(0x29c)]({'consumes':_0x3625d6[_0x2ba41c(0x2d3)],'actor':_0x3625d6['actor']});_0x200a2d['consumeType']='charges',_0x200a2d[_0x2ba41c(0x248)]=_0x3625d6['vetConsumes']['amount']??0x1,_0x200a2d[_0x2ba41c(0x2ba)]=_0x3ab183?.['id'];return;}if(!this[_0x2ba41c(0x22d)](_0x5a905f[_0x2ba41c(0x295)],_0x3625d6))return;const _0x230780=Config[_0x2ba41c(0x2d2)]({'isValueKey':!![]}),_0x1effdf=Parser['spLevelToSpellPoints'](_0x5a905f['level']);if(_0x230780===ConfigConsts[_0x2ba41c(0x2c4)]){if(_0x200a2d['consumeType']===undefined)_0x200a2d[_0x2ba41c(0x2a3)]=_0x2ba41c(0x266);if(_0x200a2d['consumeAmount']===undefined)_0x200a2d[_0x2ba41c(0x248)]=_0x1effdf;if(_0x200a2d[_0x2ba41c(0x2ba)]===undefined)_0x200a2d['consumeTarget']=_0x3625d6[_0x2ba41c(0x260)];return;}if(_0x200a2d[_0x2ba41c(0x2a3)]===undefined)_0x200a2d['consumeType']='attribute';if(_0x200a2d[_0x2ba41c(0x248)]===undefined)_0x200a2d[_0x2ba41c(0x248)]=_0x1effdf;if(_0x200a2d['consumeTarget']===undefined)_0x200a2d[_0x2ba41c(0x2ba)]=_0x230780;}static['_pGetSpellItem_getLevel'](_0x107b07){const _0x27fb7d=_0x30567f;if(!isNaN(_0x107b07[_0x27fb7d(0x295)])&&_0x107b07[_0x27fb7d(0x295)]>=0x0&&_0x107b07[_0x27fb7d(0x295)]<=0x9)return Math['round'](_0x107b07['level']);if(!isNaN(_0x107b07[_0x27fb7d(0x295)]))return Math[_0x27fb7d(0x1fd)](Math['round'](_0x107b07[_0x27fb7d(0x295)]),0x0,0x9);return 0x0;}static[_0x30567f(0x2ac)]({spell:_0x13f47e,opts:_0x4c3646,state:_0x4fbebb}){const _0x5baa27=_0x30567f;_0x4fbebb[_0x5baa27(0x280)]=_0x4fbebb[_0x5baa27(0x280)]||_0x13f47e[_0x5baa27(0x2cd)][0x0]?.[_0x5baa27(0x207)],_0x4fbebb[_0x5baa27(0x20d)]=_0x4fbebb['activationCost']||_0x13f47e[_0x5baa27(0x2cd)][0x0]?.[_0x5baa27(0x252)],_0x4fbebb[_0x5baa27(0x22f)]=_0x4fbebb['activationCondition']||Renderer[_0x5baa27(0x228)](_0x13f47e['time'][0x0]?.[_0x5baa27(0x2c3)]||'');if(!UtilCompat[_0x5baa27(0x225)]()||_0x4fbebb['activationType']!==_0x5baa27(0x233)||!_0x4fbebb[_0x5baa27(0x22f)])return null;_0x4fbebb[_0x5baa27(0x280)]=_0x5baa27(0x281),_0x4fbebb[_0x5baa27(0x22f)][_0x5baa27(0x29f)](/\bwhich you take when you take (?:[^?!.]+ )?damage\b/i,()=>{return _0x4fbebb['activationType']='reactiondamage','';})[_0x5baa27(0x29f)](/\bin response to being damaged\b/i,()=>{const _0x1c5261=_0x5baa27;return _0x4fbebb[_0x1c5261(0x280)]='reactiondamage','';})[_0x5baa27(0x29f)](/\bwhen you are hit\b/i,()=>{const _0x104fd2=_0x5baa27;return _0x4fbebb[_0x104fd2(0x280)]=_0x104fd2(0x233),'';})[_0x5baa27(0x29f)](/\b(?:succeeds on|makes) an attack roll\b/i,()=>{return _0x4fbebb['activationType']='reaction','';});}static['_pGetSpellItem_mut_srdData']({spell:_0x45a251,opts:_0x64b79b,srdData:_0x117cdf,state:_0x2f2ea7}){const _0x567988=_0x30567f;if(!_0x117cdf)return;_0x2f2ea7[_0x567988(0x26f)]=Config[_0x567988(0x23b)]({'configGroup':_0x567988(0x25f),'originalValue':MiscUtil['get'](_0x117cdf,'data',_0x567988(0x297),'value'),'originalUnit':MiscUtil[_0x567988(0x238)](_0x117cdf,_0x567988(0x2a9),_0x567988(0x297),'units')})||_0x2f2ea7[_0x567988(0x26f)],_0x2f2ea7[_0x567988(0x212)]=Config[_0x567988(0x239)]({'configGroup':'importSpell','originalUnit':MiscUtil[_0x567988(0x238)](_0x117cdf,_0x567988(0x2a9),_0x567988(0x297),'units')})||_0x2f2ea7[_0x567988(0x212)],_0x2f2ea7['targetType']=MiscUtil[_0x567988(0x238)](_0x117cdf,_0x567988(0x2a9),_0x567988(0x297),_0x567988(0x1f7))||_0x2f2ea7['targetType'];if(!_0x2f2ea7[_0x567988(0x249)])_0x2f2ea7['damageParts']=MiscUtil[_0x567988(0x238)](_0x117cdf,_0x567988(0x2a9),_0x567988(0x2c1),_0x567988(0x2af))||_0x2f2ea7[_0x567988(0x23c)];if(!_0x2f2ea7['cantripScaling']&&!_0x2f2ea7['scaling'])_0x2f2ea7[_0x567988(0x289)]=MiscUtil['get'](_0x117cdf,_0x567988(0x2a9),'scaling','formula');}static async[_0x30567f(0x236)](_0x541658){const _0xb58e0b=_0x30567f;return DataConverter[_0xb58e0b(0x23e)](_0xb58e0b(0x1fb),_0x541658);}static[_0x30567f(0x2a5)](_0x79b9df){const _0x85ad1b=_0x30567f;switch(_0x79b9df[_0x85ad1b(0x2cb)]){case'A':return _0x85ad1b(0x262);case'C':return _0x85ad1b(0x1f5);case'D':return'icons/magic/perception/orb-eye-scrying.webp';case'E':return'icons/magic/air/wind-vortex-swirl-purple.webp';case'V':return _0x85ad1b(0x208);case'I':return _0x85ad1b(0x20f);case'N':return _0x85ad1b(0x27e);case'T':return _0x85ad1b(0x24e);}}static['_getSpellFlags'](_0x4f2d5e,{parentClassName:_0x48a762,parentClassSource:_0x57e859,parentSubclassName:_0x191796,parentSubclassSource:_0x835024}={}){const _0x273ab5=_0x30567f,_0x34b2e8={[SharedConsts['MODULE_NAME_FAKE']]:{'page':UrlUtil[_0x273ab5(0x2ad)],'source':_0x4f2d5e[_0x273ab5(0x264)],'hash':UrlUtil[_0x273ab5(0x29a)][UrlUtil[_0x273ab5(0x2ad)]](_0x4f2d5e),'propDroppable':_0x273ab5(0x1fb)}};if(!_0x48a762&&!_0x57e859&&!_0x191796&&!_0x835024)return _0x34b2e8;return _0x34b2e8[SharedConsts[_0x273ab5(0x265)]][_0x273ab5(0x259)]=_0x48a762,_0x34b2e8[SharedConsts[_0x273ab5(0x265)]][_0x273ab5(0x2a1)]=_0x57e859,_0x34b2e8[SharedConsts[_0x273ab5(0x265)]][_0x273ab5(0x274)]=_0x191796,_0x34b2e8[SharedConsts[_0x273ab5(0x265)]]['parentSubclassSource']=_0x835024,_0x34b2e8;}static async[_0x30567f(0x204)](_0x5d056a,_0x31138e,_0xde1bc3){const _0x5dad65=_0x30567f,_0x23ccef=MiscUtil['copy'](_0x31138e?.[_0x5dad65(0x2bf)]||[]);return _0x23ccef[_0x5dad65(0x283)](_0x291684=>_0x291684[_0x5dad65(0x279)]=_0xde1bc3),await this[_0x5dad65(0x222)](null,_0x5d056a)&&_0x23ccef[_0x5dad65(0x2b6)](...await this[_0x5dad65(0x26e)](null,_0x5d056a,null,{'img':_0xde1bc3})),DataConverter[_0x5dad65(0x247)](_0x23ccef,'importSpell'),_0x23ccef;}static['_pGetSpellItem_parseAndAddDamage'](_0x47bfb6,_0x522de2){const _0x2cd3bc=_0x30567f;_0x47bfb6[_0x2cd3bc(0x29f)](/{@damage ([^}]+)} ([^ ]+)(, [^ ]+)*(,? or [^ ]+)? damage/ig,(..._0x54fa28)=>{const _0x58dff9=_0x2cd3bc;_0x522de2[_0x58dff9(0x2b6)]([_0x54fa28[0x1],_0x54fa28[0x2]]);});}static[_0x30567f(0x21f)](){return/{@dice ([^}]+)}(\s*\+\s*your\s+spellcasting\s+ability\s+modifier)?/i;}static[_0x30567f(0x20e)]({spell:_0x4c2d20,opts:_0xce54ff,damageTuples:_0x26ee56,isCustomDamageParts:_0x534256,scaling:_0x3ea057,preparationMode:_0xc7f4f4}){const _0x21d6a7=_0x30567f;if(!_0x4c2d20[_0x21d6a7(0x1f6)])return;const _0x2b0753={'damageTuples':MiscUtil[_0x21d6a7(0x272)](_0x26ee56),'isCustomDamageParts':_0x534256,'scaling':_0x3ea057},_0x164c23=/{@(?:scaledice|scaledamage) ([^}]+)}/gi,_0x3fded5=[/\badditional (?<addPerLevel>\d+) for each (?:slot )?level\b/gi,/\bincreases by (?<addPerLevel>\d+) for each (?:slot )?level\b/gi];let _0x240d3d=null;const _0x53ad07=new Set(),_0x1c61d3=_0x45e542=>{const _0x22985f=_0x21d6a7;_0x45e542[_0x22985f(0x29f)](_0x164c23,(..._0x2f01a2)=>{const _0x16650c=_0x22985f,[_0x333de0]=_0x2f01a2[0x1]['split']('|')[_0x16650c(0x1fc)](_0x26a8d7=>_0x26a8d7['trim']()),[_0x57abe2,_0x51743f]=Renderer[_0x16650c(0x21a)](_0x2f01a2[0x0][_0x16650c(0x298)](0x1,-0x1)),_0x12b69c=Renderer[_0x16650c(0x205)](_0x57abe2,_0x51743f),_0x36e808=_0x2b0753[_0x16650c(0x267)][_0x16650c(0x24a)](_0x1b4ab1=>(_0x1b4ab1[0x0]||'')['trim']()['toLowerCase']()===_0x333de0[_0x16650c(0x206)]());if(!_0x53ad07[_0x16650c(0x2ce)](_0x36e808)&&~_0x36e808){const _0x166164=_0x12b69c?.[_0x16650c(0x213)]?.[_0x16650c(0x200)]?.[_0xce54ff[_0x16650c(0x2cf)]];_0x166164&&(_0x53ad07[_0x16650c(0x2a7)](_0x36e808),_0x2b0753[_0x16650c(0x267)][_0x36e808][0x0]+='+\x20'+_0x166164,_0x2b0753['isCustomDamageParts']=!![]);}}),_0x3fded5[_0x22985f(0x283)](_0x3efeb2=>{const _0x1c0884=_0x22985f;_0x45e542[_0x1c0884(0x29f)](_0x3efeb2,(..._0x26a139)=>{const _0x4939fc=_0x1c0884;if(!_0x2b0753[_0x4939fc(0x267)][_0x4939fc(0x2ab)])return;const _0xab4256=_0xce54ff['castAtLevel']*Number(_0x26a139[_0x4939fc(0x1f4)]()['addPerLevel']);_0x2b0753[_0x4939fc(0x267)][0x0][0x0]+='+\x20'+_0xab4256,_0x2b0753['isCustomDamageParts']=!![];});});},_0xf5f6f4=_0x3a0bbe=>{const _0x396d06=_0x21d6a7;if(_0x2b0753[_0x396d06(0x289)])return;_0x3a0bbe[_0x396d06(0x29f)](_0x164c23,(..._0x50309c)=>{const _0x4a41c1=_0x396d06;if(_0x2b0753[_0x4a41c1(0x289)])return;const [,_0x3b688f,_0x5b2db1]=_0x50309c[0x1][_0x4a41c1(0x2b0)]('|'),_0x1ad158=MiscUtil['parseNumberRange'](_0x3b688f,0x1,0x9),[_0x35772b,_0x5b9c4f]=[..._0x1ad158][_0x4a41c1(0x26c)](SortUtil['ascSort']),_0x553542=Math[_0x4a41c1(0x282)](..._0x1ad158);_0x2b0753['scaling']=_0x5b2db1;}),_0x3fded5[_0x396d06(0x283)](_0xa8f903=>{const _0x5e773a=_0x396d06;_0x3a0bbe[_0x5e773a(0x29f)](_0xa8f903,(..._0x2bf640)=>{const _0xc8399f=_0x5e773a;if(_0x2b0753['scaling'])return;_0x2b0753[_0xc8399f(0x289)]='(@item.level\x20-\x20'+_0x4c2d20[_0xc8399f(0x295)]+_0xc8399f(0x2b7)+_0x2bf640[_0xc8399f(0x1f4)]()[_0xc8399f(0x25b)];});});};return _0xce54ff['castAtLevel']!=null&&_0xce54ff[_0x21d6a7(0x2cf)]!==_0x4c2d20[_0x21d6a7(0x295)]&&_0x2b0753[_0x21d6a7(0x267)][_0x21d6a7(0x2ab)]&&_0xc7f4f4===_0x21d6a7(0x1ff)?_0x240d3d=_0x1c61d3:_0x240d3d=_0xf5f6f4,MiscUtil['getWalker']({'isNoModification':!![]})['walk'](_0x4c2d20[_0x21d6a7(0x1f6)],{'string':_0x40aa05=>_0x240d3d(_0x40aa05)}),_0x2b0753;}static[_0x30567f(0x2a4)](_0x39213f){const _0x2df14e=_0x30567f;if(!Config[_0x2df14e(0x238)]('importSpell',_0x2df14e(0x27c)))return'';return UtilDataConverter[_0x2df14e(0x2a8)](async()=>{const _0x17119d=_0x2df14e,_0x3fee95=await DataConverter[_0x17119d(0x284)](_0x39213f),_0x2de1d7=_0x39213f[_0x17119d(0x1f6)]?await DataConverter['pGetEntryDescription'](_0x39213f,{'prop':_0x17119d(0x1f6)}):'',_0x4c0f1c=[_0x3fee95,_0x2de1d7];if(Config['get'](_0x17119d(0x25f),'isIncludeClassesInDescription')){const _0x7716ed=Renderer[_0x17119d(0x1fb)]['getCombinedClasses'](_0x39213f,_0x17119d(0x24b));if(_0x7716ed?.[_0x17119d(0x2ab)]){const [_0x56d947]=Parser[_0x17119d(0x2aa)](_0x7716ed);_0x4c0f1c[_0x17119d(0x2b6)](_0x17119d(0x1fa)+Parser[_0x17119d(0x29e)](_0x56d947,{'isTextOnly':!![]})+'</div>');}}return _0x4c0f1c[_0x17119d(0x28e)](Boolean)[_0x17119d(0x211)]('');});}static async['_pGetDataSideLoaded'](_0x216569,{targetUnits:_0x5ca34c}={}){const _0x6b557=_0x30567f,_0x5384d5=await super[_0x6b557(0x24f)](_0x216569);if(!_0x5384d5)return _0x5384d5;if(_0x5384d5['target.value'])_0x5384d5[_0x6b557(0x287)]=Config[_0x6b557(0x23b)]({'configGroup':'importSpell','originalValue':_0x5384d5['target.value'],'originalUnit':_0x5384d5[_0x6b557(0x23f)]||_0x5ca34c});if(_0x5384d5[_0x6b557(0x23f)])_0x5384d5['target.units']=Config[_0x6b557(0x239)]({'configGroup':_0x6b557(0x25f),'originalUnit':_0x5384d5['target.units']||_0x5ca34c});return _0x5384d5;}static[_0x30567f(0x21d)](_0x37c642,_0x5603c6,_0x2c90f2){const _0x3a3243=_0x30567f;if(!_0x5603c6||!_0x2c90f2)return null;return _0x37c642[_0x3a3243(0x220)]&&_0x37c642[_0x3a3243(0x220)][_0x3a3243(0x254)](_0x279384=>(_0x279384[_0x3a3243(0x24c)]||'')[_0x3a3243(0x206)]()===_0x5603c6['toLowerCase']()&&(!Config[_0x3a3243(0x238)]('import',_0x3a3243(0x29d))||(UtilDataConverter[_0x3a3243(0x290)](_0x279384)[_0x3a3243(0x264)]||'')[_0x3a3243(0x206)]()===_0x2c90f2[_0x3a3243(0x206)]()));}static async[_0x30567f(0x20b)](_0x20aaf9,_0x5eac41){const _0x3e3e18=_0x30567f;if(!_0x20aaf9)return;await UtilDocuments[_0x3e3e18(0x232)](_0x20aaf9,{'data':{'preparation':{'prepared':_0x5eac41}}});}static async[_0x30567f(0x222)](_0x39e3e8,_0x439597){const _0x5d1bfa=_0x30567f;return(await DataConverter['_pGetEffectsRawSideLoaded_'](_0x439597,this[_0x5d1bfa(0x227)]))?.[_0x5d1bfa(0x2ab)]>0x0;}static async[_0x30567f(0x26e)](_0x1e9e46,_0x1ca6bb,_0x823628,{additionalData:_0x358f21,img:_0x4ef6ce}={}){const _0x2028f1=_0x30567f,_0x546341=await DataConverter[_0x2028f1(0x223)](_0x1ca6bb,this[_0x2028f1(0x227)]);return UtilActiveEffects[_0x2028f1(0x268)](_0x546341||[],{'actor':_0x1e9e46,'sheetItem':_0x823628,'parentName':_0x1ca6bb[_0x2028f1(0x24c)],'additionalData':_0x358f21,'img':_0x4ef6ce});}}export{DataConverterSpell};