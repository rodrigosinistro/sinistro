const _0x1354b0=_0x278a;(function(_0xb4f5a2,_0x4ba328){const _0x598961=_0x278a,_0x4f911b=_0xb4f5a2();while(!![]){try{const _0x356a80=-parseInt(_0x598961(0x133))/0x1*(-parseInt(_0x598961(0x15e))/0x2)+-parseInt(_0x598961(0x16b))/0x3*(-parseInt(_0x598961(0x139))/0x4)+-parseInt(_0x598961(0x172))/0x5*(-parseInt(_0x598961(0x14f))/0x6)+-parseInt(_0x598961(0x135))/0x7*(parseInt(_0x598961(0x17d))/0x8)+parseInt(_0x598961(0x168))/0x9*(parseInt(_0x598961(0x166))/0xa)+parseInt(_0x598961(0x13a))/0xb+parseInt(_0x598961(0x140))/0xc*(-parseInt(_0x598961(0x17c))/0xd);if(_0x356a80===_0x4ba328)break;else _0x4f911b['push'](_0x4f911b['shift']());}catch(_0x554e03){_0x4f911b['push'](_0x4f911b['shift']());}}}(_0x265a,0xea6a1));import{UtilLibWrapper}from'./PatcherLibWrapper.js';import{SharedConsts}from'../shared/SharedConsts.js';import{Config}from'./Config.js';import{UtilActiveEffects}from'./UtilActiveEffects.js';import{LGT,Util}from'./Util.js';import{Patcher_RollData}from'./PatcherRollData.js';import{UtilHooks}from'./UtilHooks.js';class Patcher_Actor{static[_0x1354b0(0x144)](){const _0x4bd23a=_0x1354b0;this['_init_tryPatchGetRollData'](),this[_0x4bd23a(0x16c)]();}static[_0x1354b0(0x165)](){const _0x17e9d6=_0x1354b0;try{UtilLibWrapper[_0x17e9d6(0x173)](_0x17e9d6(0x158),this['_lw_CONFIG_Actor_documentClass_prototype_getRollData'],UtilLibWrapper['LIBWRAPPER_MODE_WRAPPER']);}catch(_0x5f4de6){console[_0x17e9d6(0x16f)](...LGT,_0x17e9d6(0x171),_0x5f4de6);}}static['_lw_CONFIG_Actor_documentClass_prototype_getRollData'](_0x15f74f,..._0x1e2449){const _0xe5e713=_0x1354b0,_0x5ee5e8=_0x15f74f(..._0x1e2449);return Patcher_Actor[_0xe5e713(0x169)](this,_0x5ee5e8);}static[_0x1354b0(0x169)](_0x3b5a15,_0x22a08e){const _0x1d3525=_0x1354b0;if(!_0x22a08e)return _0x22a08e;return Object[_0x1d3525(0x163)](_0x22a08e,Patcher_RollData[_0x1d3525(0x153)](_0x3b5a15)),Patcher_RollData['addBabeleCompatibilityRollData'](_0x22a08e,_0x3b5a15),_0x22a08e;}static[_0x1354b0(0x16c)](){const _0x5db1b6=_0x1354b0;UtilLibWrapper['addPatch'](_0x5db1b6(0x16a),this[_0x5db1b6(0x15c)],UtilLibWrapper['LIBWRAPPER_MODE_MIXED']),UtilHooks['on'](UtilHooks['HK_CONFIG_UPDATE'],()=>this[_0x5db1b6(0x142)]());}static[_0x1354b0(0x15c)](_0xf32843,..._0xb4da8){const _0x4bc3be=_0x1354b0;if(!Config['get'](_0x4bc3be(0x14a),_0x4bc3be(0x162)))return _0xf32843(..._0xb4da8);return Patcher_Actor[_0x4bc3be(0x159)](this,..._0xb4da8);}static[_0x1354b0(0x142)](){const _0x33d585=_0x1354b0;CONFIG[_0x33d585(0x13b)][_0x33d585(0x148)]['instance']['contents'][_0x33d585(0x145)](_0x4f8be7=>{const _0x3f9adc=_0x33d585;_0x4f8be7[_0x3f9adc(0x143)]();if(_0x4f8be7['sheet']?.['element']?.[_0x3f9adc(0x14c)])_0x4f8be7[_0x3f9adc(0x14e)]['render']();});}static[_0x1354b0(0x159)](_0x2235f8){const _0x1a5b3c=_0x1354b0;if(!_0x2235f8['effects']||!_0x2235f8['effects']['size']&&!_0x2235f8[_0x1a5b3c(0x177)][_0x1a5b3c(0x14c)])return;const _0x5c57de={},_0x541233=_0x2235f8[_0x1a5b3c(0x177)]['reduce']((_0x27a979,_0x531393)=>{const _0x329195=_0x1a5b3c;if(_0x531393['data'][_0x329195(0x132)]||_0x531393['isSuppressed'])return _0x27a979;return _0x27a979['concat'](_0x531393[_0x329195(0x17b)][_0x329195(0x13f)][_0x329195(0x136)](_0x1d40d6=>{const _0x7e7f2c=_0x329195;return _0x1d40d6=foundry['utils']['duplicate'](_0x1d40d6),_0x1d40d6['effect']=_0x531393,_0x1d40d6['priority']=_0x1d40d6[_0x7e7f2c(0x179)]??_0x1d40d6[_0x7e7f2c(0x146)]*0xa,_0x1d40d6;}));},[]);_0x541233['sort']((_0x8b22ee,_0x27684)=>_0x8b22ee[_0x1a5b3c(0x179)]-_0x27684[_0x1a5b3c(0x179)]),Patcher_Actor['_applyActiveEffects_mutValues'](_0x2235f8,_0x541233);for(let _0x25627d of _0x541233){const _0x44eb61=_0x25627d[_0x1a5b3c(0x152)][_0x1a5b3c(0x13d)](_0x2235f8,_0x25627d);if(_0x44eb61!==null)_0x5c57de[_0x25627d[_0x1a5b3c(0x155)]]=_0x44eb61;}_0x2235f8[_0x1a5b3c(0x157)]=foundry[_0x1a5b3c(0x141)]['expandObject'](_0x5c57de);}static['_applyActiveEffects_mutValues'](_0x23ba68,_0x40af1a){const _0x50bd45=_0x1354b0;if(!_0x40af1a[_0x50bd45(0x14c)])return;let _0x498521;const _0x110c82=UtilActiveEffects[_0x50bd45(0x176)](_0x23ba68,{'isActorEffect':!![]});_0x40af1a['forEach'](_0x5b400b=>{const _0x5913c9=_0x50bd45;if(typeof _0x5b400b[_0x5913c9(0x12e)]!=='string')return;const _0x4dcc1d=UtilActiveEffects[_0x5913c9(0x13e)](_0x110c82,_0x5b400b['key']);switch(_0x4dcc1d){case _0x5913c9(0x151):case'array':{try{_0x5b400b['value']=eval(_0x5b400b[_0x5913c9(0x12e)]);}catch(_0x17e01e){if(Util[_0x5913c9(0x15a)]())console['error'](...LGT,_0x17e01e);}break;}case undefined:case null:case'null':case _0x5913c9(0x164):case _0x5913c9(0x16d):{if(!_0x498521)_0x498521=Patcher_Actor['_applyActiveEffects_getFullRollData'](_0x23ba68);try{_0x5b400b[_0x5913c9(0x12e)]=this['_getEvaluatedExpression'](_0x23ba68,_0x5b400b[_0x5913c9(0x12e)],_0x498521);if(_0x4dcc1d===_0x5913c9(0x16d))_0x5b400b['value']=!!_0x5b400b[_0x5913c9(0x12e)];}catch(_0x2e1986){if(Util['isDebug']())console[_0x5913c9(0x16f)](...LGT,_0x2e1986);}break;}case'string':case _0x5913c9(0x175):default:break;}});}static[_0x1354b0(0x17e)](_0x544054,_0x1cccc1,_0x513495){const _0x52d5f3=_0x1354b0,_0x4a2339=_0x1cccc1[_0x52d5f3(0x130)](/@(?<path>[-a-zA-Z0-9.]+)/g,(..._0x4e0a54)=>{const _0x4793e8=_0x52d5f3,_0x7604a9=foundry[_0x4793e8(0x141)][_0x4793e8(0x14d)](_0x513495,_0x4e0a54[_0x4793e8(0x161)]()[_0x4793e8(0x15b)]);if(_0x7604a9===undefined)return console['warn'](...LGT,_0x4793e8(0x147)+_0x4e0a54[_0x4793e8(0x161)]()[_0x4793e8(0x15b)]+'\x22\x20in\x20expression\x20\x22'+_0x1cccc1+'\x22\x20for\x20actor\x20\x22'+_0x544054[_0x4793e8(0x15d)]+_0x4793e8(0x14b)+_0x544054['id']+')'),0x0;return _0x7604a9;})[_0x52d5f3(0x130)](/\btrue\b/g,0x1)[_0x52d5f3(0x130)](/\bfalse\b/g,0x0)[_0x52d5f3(0x130)](/\bnull\b/g,0x0);let _0x2eb4d9;try{_0x2eb4d9=Renderer[_0x52d5f3(0x154)][_0x52d5f3(0x17a)][_0x52d5f3(0x149)](_0x4a2339,![]);}catch(_0x773639){return console['warn'](...LGT,'Failed\x20to\x20parse\x20expression\x20\x22'+_0x1cccc1+_0x52d5f3(0x150)+_0x4a2339+_0x52d5f3(0x12f)+_0x544054[_0x52d5f3(0x15d)]+')\x20'+_0x544054['id']+_0x52d5f3(0x167),_0x773639['message']),0x0;}return _0x2eb4d9[_0x52d5f3(0x12d)][_0x52d5f3(0x156)]({});}static[_0x1354b0(0x174)](_0x4795fb){const _0x266dfc=_0x1354b0,_0x23763b=MiscUtil[_0x266dfc(0x160)](_0x4795fb[_0x266dfc(0x17b)]);_0x23763b[_0x266dfc(0x177)]=[];const _0x2593a3=new CONFIG[(_0x266dfc(0x13b))][(_0x266dfc(0x134))]({..._0x23763b});return _0x2593a3[_0x266dfc(0x143)](),_0x2593a3[_0x266dfc(0x13c)]();}static[_0x1354b0(0x16e)](_0x39a1f5,_0x3f35b4){const _0x5615dd=_0x1354b0;if(!Config[_0x5615dd(0x131)](_0x5615dd(0x14a),'isUseExtendedActiveEffectsParser'))return;if(!(_0x3f35b4[_0x5615dd(0x155)]||'')[_0x5615dd(0x138)](SharedConsts['MODULE_NAME_FAKE']))return;const _0x4b95c7=UtilActiveEffects[_0x5615dd(0x170)](_0x3f35b4[_0x5615dd(0x155)]);switch(_0x4b95c7){case _0x5615dd(0x15f):{const {value:_0x1a5f47}=_0x3f35b4,_0x98baae=foundry[_0x5615dd(0x141)][_0x5615dd(0x14d)](_0x39a1f5[_0x5615dd(0x17b)],_0x4b95c7);if(typeof _0x98baae===_0x5615dd(0x164)&&_0x98baae>=Number(_0x1a5f47))return null;setProperty(_0x39a1f5['data'],_0x4b95c7,_0x1a5f47);return;}default:console[_0x5615dd(0x178)](...LGT,_0x5615dd(0x137)+_0x4b95c7);}}}function _0x278a(_0x487474,_0x35024d){const _0x265abe=_0x265a();return _0x278a=function(_0x278a1e,_0x559e95){_0x278a1e=_0x278a1e-0x12d;let _0x242a51=_0x265abe[_0x278a1e];return _0x242a51;},_0x278a(_0x487474,_0x35024d);}function _0x265a(){const _0x505e66=['changes','37428sYVllW','utils','_handleConfigUpdate','prepareData','init','forEach','mode','Failed\x20to\x20resolve\x20attribute\x20\x22','collection','getTree3','actor','\x22\x20(','length','getProperty','sheet','768heFpqm','\x22\x20(\x22','object','effect','getAdditionalRollDataBase','dice','key','evl','overrides','CONFIG.Actor.documentClass.prototype.getRollData','_applyActiveEffects','isDebug','path','_lw_Actor_prototype_applyActiveEffects','name','270092QDVmWR','data.attributes.ac.flat','copy','last','isUseExtendedActiveEffectsParser','assign','number','_init_tryPatchGetRollData','10sZntDN','\x20active\x20effects','788157VbKyVR','_getRollData','Actor.prototype.applyActiveEffects','64173EniRrt','_init_tryPatchApplyActiveEffects','boolean','handleHookApplyActiveEffect','error','getKeyFromCustomKey','Failed\x20to\x20bind\x20getRollData\x20handler!','3305CYzHIa','addPatch','_applyActiveEffects_getFullRollData','undefined','getAvailableEffectsLookup','effects','warn','priority','lang','data','1651JpLfcE','2694168RgVIuy','_getEvaluatedExpression','tree','value','\x22\x20with\x20roll\x20data\x20applied)\x20in\x20actor\x20(','replace','get','disabled','4UJFdgz','documentClass','35UaeJdy','map','Unhandled\x20custom\x20active\x20effect\x20key:\x20','startsWith','200DxuCUZ','13840354pFOqEc','Actor','getRollData','apply','getActiveEffectType'];_0x265a=function(){return _0x505e66;};return _0x265a();}export{Patcher_Actor};